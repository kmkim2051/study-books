# [아이템 75] 예외 상세 메시지에 실패 관련 정보를 담으라

### **예외를 잡지 못해 프로그램이 실패하면?**

자바는 예외의 **스택 추적(stack trace)** 정보를 자동으로 출력

- 스택 추적
예외 객체의 toString 메서드를 호출해 얻는 문자열로, 예외 클래스 이름 뒤 상세 메시지가 붙는 형태
- 문제를 분석하는 프로그래머 또는 SRE 엔지니어가 얻는 유일한 정보인 경우가 많다.
- 실패를 재현하기 어렵다면 더 자세한 정보 얻을 수 없음

→ 예외의 toString에 가능한 많은 정보를 담는 것이 중요

→ 사후 분석을 위해 상황을 정확히 포착해 상세 메시지에 담아야 함

**실패 순간을 포착하려면**

**→ 예외에 관여된 모든 매개변수와 필드 값을 실패 메시지에 담아야 한다**

예시

- IndexOutofBoundsException: 범위 최솟값, 최댓값, 범위를 벗어난 인덱스의 값
- 셋 중 한두 개 또는 전부 잘못되었을 수도 있음
    - index == -1, index == size
    - 범위를 아주 크게 벗어나거나, 불변식이 깨진 경우 (min > max)

**보안에 민감한 정보는 담지 않도록 주의 (비밀번호, 액세스 키 등)**

**예외의 상태 메시지와 최종 사용자용 오류 메시지를 혼동하지 말자**

- 예외 메시지: 가독성보다는 내용이 중요
    - 주 소비층은 프로그래머와 SRE 엔지니어
- 최종 사용자용 메시지: 친절한 안내 메시지
    
    

실패를 적절히 포착하려면, 필요한 정보를 **생성자에서 받아 상세 메시지까지 미리 생성**해놓는 방법

- 현재의 IndexOutOfBoundsException 생성자는 String을 받음
- 다음과 같이 구성했으면 더 좋았을 것

```java
public IndexOutOfBoundsException(int lower, int upper, int i) {
  super(String.format("최소: %d, 최대: %d, 인덱스: %d", lower, upper, i);
  this.lower = lower;
  this.upper = upper;
  this.index = i;
}
// 자바 9에 인덱스를 받는 생성자가 추가됨
```

**예외는 실패와 관련한 정보를 얻을 수 있는 접근자 메서드를 제공하는 것이 좋다**

- 위 예시라면 (get)lowerBound, upperBound, index 정도
- 포착한 실패 정보는 예외 상황 복구에 유용하므로, 검사 예외에서 더 유용

비검사 예외의 상세 정보에 접근할 개발자는 잘 없겠지만, ‘toString이 반환값에 포함된 정보를 얻어올 수 있는 메서드를 제공하자(아이템 75)’ 를 따르는 관점에서, 있으면 좋다.