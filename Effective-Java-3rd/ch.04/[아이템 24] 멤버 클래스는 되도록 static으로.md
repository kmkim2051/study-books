# [아이템 24] 멤버 클래스는 되도록 static으로 만들라

### 중첩 클래스란

다른 클래스 안에 정의된 클래스를 말한다. **자신을 감싼 바깥 클래스에서만 쓰여야 하며**, 
그 외의 쓰임새가 있다면 톱레벨 클래스로 만들어야 한다.

### 중첩 클래스의 종류

- 정적 멤버 클래스
- 비정적 멤버 클래스
- 익명 클래스
- 지역 클래스

### 정적 멤버 클래스

다른 클래스 안에 선언되고, 바깥 클래스의 private 멤버에 접근할 수 있다는 점만 빼면 일반 클래스와 동일

흔히 **바깥 클래스와 함께** 쓰일 때만 유용한 **public helper 클래스**로 쓰인다.

**예시**

계산기가 지원하는 연산 종류를 정의하는 enum (아이템 34)

*Operation* enum은 Calculator 클래스의 public static 멤버가 되어야 한다.

- 클라이언트에서  *Calculator.Operation.PLUS* 와 같이 참조 가능

### 비정적 멤버 클래스

정적 멤버 클래스와 static의 유무만 다르지만, 의미상 차이는 꽤 크다.

- 비정적 멤버 클래스의 인스턴스는 바깥 클래스의 **인스턴스와 암묵적으로 연결**
- 비정적 멤버 클래스의 인스턴스 메서드에서, 정규화된 this를 사용해 **바깥 인스턴스의 메서드를 호출하거나, 바깥 인스턴스의 참조를 가져올 수 있음**
    - 정규화된 this: 클래스명.this 형태로 바깥 클래스의 이름을 명시하는 용법
- 개념상 중첩 클래스의 인스턴스가 바깥 인스턴스와 **독립적 존재** 가능 → 정적 멤버 클래스로 만들어야 함
    - 비정적 멤버 클래스는 바깥 인스턴스 없이는 만들 수 없기 때문

비정적 멤버 클래스의 인스턴스와 바깥 인스턴스 사이의 관계는

멤버 클래스가 인스턴스화될 때 확립되며 더 이상 변경할 수 없다.

- 바깥 클래스의 인스턴스 메서드에서, 비정적 멤버 클래스의 생성자를 호출 시 자동으로 만들어지는게 보통
- 드물게 **바깥인스턴스클래스.new MemberClas(arg) 처럼 수동으로 만들기도 함**
    - 이 관계 정보는 비정적 멤버 클래스 인스턴스 안에 만들어져 메모리 공간을 차지하고, 생성시간도 더 걸림

### 비정적 멤버 클래스의 사용 사례

비정적 멤버 클래스는 **어댑터**를 정의할 때 자주 쓰인다.

→ 어떤 클래스의 인스턴스를 감싸 마치 다른 클래스의 인스턴스처럼 보이게 하는 뷰

Map 인터페이스의 구현체들은 

보통 자신의 **컬렉션 뷰**(keySet, entrySet, values가 반환하는) 를 구현할 때 비정적 멤버 클래스를 사용

```java
public class MySet<E> extends AbstractSet<E> {
  // ...
  @Override
  public Iterator<E> iterator() {
    return new MyIterator();
  }
  
  private class MyIterator implements Iterator<E> {
    // ...
  }
```

멤버 클래스에서 **바깥 인스턴스에 접근**할 일이 없다면, 무조건 static을 붙여서 정적 멤버 클래스로 만들자.

- static을 생략하면 바깥 인스턴스로의 숨은 외부 참조를 갖게 된다.
- 시간과 공간이 소비되고, GC가 바깥 클래스의 인스턴스를 수거하지 못할 수도 있다.

### Private 정적 멤버 클래스

흔히 바깥 클래스가 표현하는 객체의 한 부분(구성요소)을 나타낼 때 쓴다.

**예시**

키와 값을 매핑시키는 Map 인스턴스

- key-value 쌍을 표현하는 Entry 객체를 가지고 있음
- 모든 엔트리가 맵과 연관되어 있지만, 엔트리의 메서드들(getKey, getValue, setValue)는 맵을 직접 사용하지는 않음 → 비정적으로 사용하면 낭비

### **멤버 클래스가 공개된 클래스의 public, protected라면 정적 여부는 더 중요해짐**

멤버 클래스 역시 공개 API가 되니, 향후 릴리즈에서 static을 붙이면 하위 호환성 깨짐

### 익명 클래스

**특징**

- 이름도 없고, 바깥 클래스의 멤버도 아님
- 쓰이는 시점에 선언과 동시에 인스턴스가 만들어짐
- 비정적인 문맥에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있다.
- 정적 문맥에서라도 상수 이외의 정적 멤버는 가질 수 없다.

**제약**

- 선언 지점에서만 인스턴스를 만들 수 있고, instanceof, 클래스의 이름이 필요한 작업은 수행 불가
- 여러 인터페이스를 구현하거나, 인터페이스 구현과 클래스 상속을 동시에 할 수 없음
- 클라이언트는 상위 타입에서 상속한 멤버 외에는 호출할 수 없음
- 표현식 중간에 등장하므로, 짧지 않으면 가독성이 떨어짐
- 작은 함수 객체, 처리 객체에 주로 사용되었으나 현재는 보통 람다로 대체
- 정적 팩터리 메서드를 구현할 때 자주 쓰임

### 지역 클래스

가장 드물게 사용되는 클래스로, 지역변수를 선언할 수 있는 곳이면 어디든 선언 가능

유효범위도 지역변수와 같다.

- 이름이 있고, 반복 사용 가능
- 비정적 문맥에서 사용될 때만 바깥 인스턴스 참조 가능
- 정적 멤버는 가질 수 없으며, 가독성을 위해 짧게 작성해야 함

### 요약

메서드 밖에서 사용하거나, 메서드 안에 정의하기 너무 길다 → 멤버 클래스

멤버 클래스의 인스턴스가 바깥 인스턴스 참조 ? 비정적 : 정적

중첩 클래스가 한 메서드 안에서만 쓰이고, 단일 생성 지점이며 해당 타입에 적합한 클래스나 인터페이스가 이미 있다 ? 익명 클래스 :  지역 클래스